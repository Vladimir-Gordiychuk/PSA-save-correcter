Общая информация
----------------

Консольная утилита PSA.Saver предназначена для правки сохранений игры Pacific Storm - Allies.

На данный момент позволяет автоматизированно выявлять и править "битые" записи PlayerId,
которые могут возникать в ходе игры в юнитах авиации. Правка записей выполняется в соответствии
с инструкцией, выложенной в комьюнити Samurai Spirit (SS) [см. секцию "Ссылки", №1].

Системные требования
--------------------

Данная консольная утилита построна для платформы .Net Framework 4.0.
Платформа .Net Framework 4.0 поставляется с большинством современных версий Windows.
Если же Ваша версия OC Windows не имеет установленного .Net Framework 4.0,
Вы можете бесплатно скачать дистрибутив с официального сайта Microsoft [ссылка №4].


Использование
-------------

Утилита предназначена для использования через console. Имеет всего один аргумент - путь к распакованному save-файлу.

Примеры использования:

PSA.Saver save1.xml                                                                          ( короткая форма )
PSA.Saver "G:\Steam\steamapps\common\Pacific Storm - Allies\save\Vladimir\save1.xml"         ( полная форма )

Путь к файлу можно указывать как в полной форме, так и в относительной.

Для удобства реализован поиск файла в save-директории, путь к которой можно указать в config файле (PSA.Saver.exe.config).
Данная функция работает при выполнении двух условий:
1. путь к файлу будет указан в короткой форме (только наименование файла, например, save9.xml);
2. файл с таким именем не существует в директории утилиты PSA.Saver.exe.

Утилита модифицирует только распакованные файлы сохранений (т.е. перед её использованием необходимо 
распаковать файл с помощью другой утилиты AttrConv.exe, которую можно найти в инструментарии для модинга [2, 3].

В ходе работы утилита проверяет наличие в save-файла записей о юнитах, модель которых отсутствует в таблице юнитов (файл "unit_map.csv").
Если такие записи будут обнаружены, утилита выводит соответствующее сообщение вида:
"
Unit map missing some models found in the save-file.
Add the following models to your 'unit_map.csv' file:
P40
A6M
IL2
...
"
В таких случаях необходимо внести соответствующие изменения в файл "unit_map.csv" (добавить новые юниты в таблицу)
и повторить процедуру. Корректный файл сохранения не должен содержать битых PlayerId.

Пользователь может редактировать соотношение между моделями и PlayerId с помощью файла unit_map.csv,
который должен быть расположен в той же директории, что и исполняемый файл PSA.Saver.
Это особенно важно в тех случаях, когда используются моды (с новыми видами юнитов).

Правила форматирования unit_map.csv файла:
1. формат файла должен соответствовать простым правилам форматирования csv-файлов (coma-separated value):
   избегайте лишних символов (например, пробелов)
   запятая испольуется только как разделитель между столбцами таблицы,
   строковые значения (наименования моделей) должны быть обернуты в кавычки (например, "P40");
2. в качестве ключей таблица должна содержать только наименования моделей.
   Например: для модификации "Airplanes.P40.mod0" необходимо указать только наименования модели, т.е. "P40".

В результате работы утилиты старый файл будет переименован (будет добавлен постфикс ".backup").
а модифицированный файл будет записан по старому пути.

Известные проблемы
------------------

1.	в ходе обработки save-файла изменяется форматирование xml-документа,
	что существенно увеличивает размер файла (+20-30%);
2.	при первой загрузке исправленного сейфа зачастую возникает crash,
	однако повторная попытка загрузки (после перезапуска игры), как правило, срабатывает.

Ссылки
------

1. Samurai Spirit (SS) комьюнити в VK ( https://vk.com/topic-170771562_39028343 )
2. Тема c обсуждениями вспомогательного ПО для PSA ( https://vk.com/topic-170771562_39028264 )
3. Инструментарий для модинга от Samurai Spirit Community ( https://cloud.mail.ru/public/9LcM/DveCWab34 )
4. Ссылка для скачивания .Net Framework 4.0 ( https://www.microsoft.com/ru-ru/download/details.aspx?id=17718 )

Автор
-----

Владимир Гордийчук
Vladimir Gordiychuk ( https://vk.com/vladimir.gordiychuk )
